# é‡å¯æœåŠ¡æŒ‡å—

## ğŸ”„ ç«‹å³æ“ä½œæ­¥éª¤

### 1ï¸âƒ£ åœæ­¢å½“å‰çš„ Worker è¿›ç¨‹

```bash
# æ–¹æ³•1ï¼šæŸ¥æ‰¾å¹¶åœæ­¢ Celery worker
pkill -f "celery.*worker"

# æ–¹æ³•2ï¼šå¦‚æœåœ¨ç»ˆç«¯ä¸­è¿è¡Œï¼ŒæŒ‰ Ctrl+C
```

### 2ï¸âƒ£ é‡å¯ Worker

```bash
cd /Users/zhangrui/Desktop/konwledge-graph/GP_back_end_py

# å¯åŠ¨ workerï¼ˆå‰å°è¿è¡Œï¼Œå¯ä»¥çœ‹åˆ°æ—¥å¿—ï¼‰
celery -A app.main.celery_app worker --loglevel=info

# æˆ–è€…åå°è¿è¡Œ
celery -A app.main.celery_app worker --loglevel=info --logfile=worker.log --detach
```

### 3ï¸âƒ£ å¯åŠ¨åç«¯æœåŠ¡ï¼ˆå¦‚æœæ²¡æœ‰è¿è¡Œï¼‰

```bash
cd /Users/zhangrui/Desktop/konwledge-graph/GP_back_end_py

# ä½¿ç”¨ uvicorn å¯åŠ¨
uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

### 4ï¸âƒ£ é‡æ–°æäº¤æå–ä»»åŠ¡

é€šè¿‡å‰ç«¯æˆ– API é‡æ–°æäº¤çŸ¥è¯†å›¾è°±æå–ä»»åŠ¡ã€‚

## ğŸ“Š éªŒè¯ä¿®å¤æ•ˆæœ

### æ£€æŸ¥æ—¥å¿—

**âœ… å¦‚æœçœ‹åˆ°è¿™äº›æ—¥å¿—ï¼Œè¯´æ˜è‡ªåŠ¨ä¿®å¤æ­£åœ¨å·¥ä½œï¼š**
```
WARNING: extraction_text is dict (should be string): {...}, attempting to fix
```

**âœ… å¦‚æœçœ‹åˆ°æå–æˆåŠŸçš„æ—¥å¿—ï¼Œè¯´æ˜é—®é¢˜å·²è§£å†³ï¼š**
```
INFO: langextract response task_id=123 url=https://... entities=10 relations=5
```

**âŒ å¦‚æœè¿˜çœ‹åˆ°è¿™ä¸ªé”™è¯¯ï¼Œè¯·è”ç³»å¼€å‘äººå‘˜ï¼š**
```
ERROR: Extraction text must be a string, integer, or float. Found: <class 'dict'>
```

## ğŸ§ª å¯é€‰ï¼šè¿è¡Œæµ‹è¯•

åœ¨é‡å¯æœåŠ¡å‰ï¼Œå¯ä»¥å…ˆè¿è¡Œæµ‹è¯•éªŒè¯ä¿®å¤ä»£ç ï¼š

```bash
cd /Users/zhangrui/Desktop/konwledge-graph/GP_back_end_py
python test_extraction_text_fix.py
```

é¢„æœŸè¾“å‡ºï¼š
```
âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼extraction_text è§„èŒƒåŒ–åŠŸèƒ½å·¥ä½œæ­£å¸¸ã€‚
```

## ğŸ“ ç›‘æ§è¦ç‚¹

é‡å¯åæ³¨æ„è§‚å¯Ÿï¼š

1. **é”™è¯¯æ˜¯å¦æ¶ˆå¤±**
   - ä¸åº”å†çœ‹åˆ° `Extraction text must be a string` é”™è¯¯

2. **è­¦å‘Šä¿¡æ¯**
   - å¦‚æœç»å¸¸çœ‹åˆ° `extraction_text is dict` è­¦å‘Šï¼Œè¯´æ˜ LLM é¢‘ç¹è¿”å›é”™è¯¯æ ¼å¼
   - è€ƒè™‘å‡çº§åˆ°æ›´å¼ºçš„æ¨¡å‹ï¼ˆå¦‚ gpt-4oï¼‰

3. **æå–è´¨é‡**
   - æ£€æŸ¥æå–çš„å®ä½“å’Œå…³ç³»æ•°é‡
   - éªŒè¯æ•°æ®çš„å‡†ç¡®æ€§

## ğŸ” æ•…éšœæ’æŸ¥

### å¦‚æœè¿˜æ˜¯æœ‰é—®é¢˜

1. **æ£€æŸ¥é…ç½®æ–‡ä»¶**
   ```bash
   cat config.yaml | grep -A 10 "langextract"
   ```

2. **æ£€æŸ¥æç¤ºè¯æ–‡ä»¶**
   ```bash
   ls -lh langextract_prompt.md
   head -20 langextract_prompt.md
   ```

3. **æŸ¥çœ‹å®Œæ•´æ—¥å¿—**
   ```bash
   tail -f worker.log
   ```

4. **éªŒè¯ä»£ç ä¿®æ”¹**
   ```bash
   grep -n "_normalize_extraction_text" app/services/graph_service.py
   ```

## ğŸ’¡ æ€§èƒ½ä¼˜åŒ–å»ºè®®

å¦‚æœæå–é€Ÿåº¦æ…¢ï¼Œå¯ä»¥è°ƒæ•´é…ç½®ï¼š

```yaml
# config.yaml
langextract:
  max_workers: 3              # å¢åŠ å¹¶å‘æ•°ï¼ˆåŸæ¥æ˜¯ 1ï¼‰
  extraction_passes: 1        # å‡å°‘æå–è½®æ•°ï¼ˆåŸæ¥æ˜¯ 2ï¼‰
  max_char_buffer: 2000       # å¢åŠ ç¼“å†²åŒºï¼ˆåŸæ¥æ˜¯ 1200ï¼‰
```

âš ï¸ **æ³¨æ„**ï¼šå¢åŠ å¹¶å‘æ•°ä¼šå¢åŠ  API è°ƒç”¨æˆæœ¬ã€‚

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. é”™è¯¯æ—¥å¿—ï¼ˆæœ€è¿‘ 50 è¡Œï¼‰
   ```bash
   tail -50 worker.log
   ```

2. é…ç½®ä¿¡æ¯
   ```bash
   cat config.yaml
   ```

3. Python ç¯å¢ƒä¿¡æ¯
   ```bash
   python --version
   pip list | grep -E "(langextract|celery|sqlalchemy)"
   ```

---

**ğŸ¯ è®°ä½ï¼šé‡å¯ worker åï¼Œç³»ç»Ÿå°±ä¼šä½¿ç”¨æ–°çš„ä¿®å¤ä»£ç ï¼**

